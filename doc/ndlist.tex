\documentclass{article}

% Input packages & formatting
\input{template/packages}
\input{template/formatting}
\input{template/version}
\renewcommand{\cleartooddpage}[1][]{\ignorespaces} % single side
\newcommand{\caret}{$^\wedge$}

\title{\Huge{N-Dimensional Lists (ndlist)}\\\large Version \version}
\author{Alex Baker\\\small\url{https://github.com/ambaker1/ndlist}}
\date{\small\today}

\begin{document}
\maketitle
\begin{abstract}
\begin{center}
The ``ndlist'' module provides tools for vector, matrix, and tensor manipulation and processing, where vectors are represented by Tcl lists, and matrices are represented by nested Tcl lists, and higher dimension lists represented by additional levels of nesting. 
Additionally, this package provides the ``ndlist'' object variable type.
\end{center}
\end{abstract}
\clearpage
\section{N-Dimensional Lists}
A ND list is defined as a list of equal length (N-1)D lists, which are defined as equal length (N-2)D lists, and so on until (N-N)D lists, which are scalars of arbitrary size.
For example, a matrix is a 2D list, or a list of equal length row vectors (1D), which contain arbitrary scalar values, as shown below:
\begin{equation*}\label{eq:matrix_AB}
A=\begin{bmatrix}
2 & 5 & 1 & 3 \\
4 & 1 & 7 & 9 \\
6 & 8 & 3 & 2 \\
7 & 8 & 1 & 4
\end{bmatrix},\quad
B=\begin{bmatrix}
9 \\ 3 \\ 0 \\ -3
\end{bmatrix},\quad
C = \begin{bmatrix}
3 & 7 & -5 & -2
\end{bmatrix}
\end{equation*}
\begin{example}[label=ex:matrix_AB]{Defining matrices in Tcl}
\begin{lstlisting}
set A {{2 5 1 3} {4 1 7 9} {6 8 3 2} {7 8 1 4}}
set B {9 3 0 -3}
set C {{3 7 -5 -2}}
\end{lstlisting}
\end{example}

This definition is flexible, and allows for different interpretations of the same data. For example, the list ``1 2 3'' can be interpreted as a scalar with value ``1 2 3'', a vector with values ``1'', ``2'', and ``3'', or a matrix with row vectors ``1'', ``2'', and ``3''.

\clearpage
\subsection{Initialization}
The command \cmdlink{nrepeat} can be used to initialize a valid ND list of any size.
\begin{syntax}
\command{nrepeat} \$shape \$value
\end{syntax}
\begin{args}
\$shape & Shape (list of dimensions) of ND list. \\
\$value & Value to repeat.
\end{args}
\begin{example}{Create nested ND list with one value}
\begin{lstlisting}
puts [nrepeat {1 2 3} 0]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{{0 0 0} {0 0 0}}
\end{lstlisting}
\end{example}

The command \cmdlink{ndlist} initializes an ND list from a value input, expanding if necessary to match maximum dimensions.
If the input value is ``ragged'', as in it has inconsistent dimensions, it will be expanded to match the maximum dimensions, filled in with the value \texttt{\$::ndlist::filler}. By default, this is 0, but can be modified.
\begin{syntax}
\command{ndlist} \$nd \$value
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$value & List to interpret as an ndlist
\end{args}
\begin{example}{Expand ragged ND list}
\begin{lstlisting}
puts [ndlist 2D {1 {2 3}}]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{{1 0} {2 3}}
\end{lstlisting}
\end{example}

\clearpage
\subsection{Access}
Portions of an ND list can be accessed with the command \cmdlink{nget}.
Aliases for matrices (2D) and vectors (1D) are provided with the commands \cmdlink{mget} and \cmdlink{vget}, and aliases for accessing matrix rows and columns (using \$i* indexing), are provided with the commands \cmdlink{rget} and \cmdlink{cget}.
\begin{syntax}
\command{nget} \$ndlist \$arg1 \$arg2 ...
\end{syntax}
\begin{args}
\$ndlist & ND list to access \\
\$arg1 \$arg2 ... & Index arguments, using index notation (see pg. \pageref{indexformat}). The number of index arguments determines the interpreted dimensions.
\end{args}

\begin{example}{Accessing matrix values, rows, and columns}
\begin{lstlisting}
set A {{1 2 3} {4 5 6} {7 8 9}}
puts [nget $A 0 0]
puts [nget $A 0 :]
puts [nget $A : 0]
\end{lstlisting}
\tcblower
\begin{lstlisting}
1
1 2 3
1 4 7
\end{lstlisting}
\end{example}

\clearpage
\subsection{Index Notation}\label{indexformat}
Index input for all ND list access and modification functions gets passed through the ND list index parser \cmdlink{::ndlist::ParseIndex}.
\begin{syntax}
\command{::ndlist::ParseIndex} \$input \$n
\end{syntax}
\begin{args}
\$input & Index input. Options are shown below: \\
\quad : & All indices \\
\quad \$start:\$stop & Range of indices (e.g. 0:4 or 1:end-2).\\
\quad \$start:\$step:\$stop & Stepped range of indices (e.g. 0:2:-2 or 2:3:end). \\
\quad \$iList & List of indices (e.g. \{0 end-1 5\} or 3). \\
\quad \$i* & Single index with asterisk, ``flattens'' the ndlist (e.g. 0* or end-3*). \\
\$n & Number of elements in list.
\end{args}
Additionally, index range arguments \texttt{\$start} and \texttt{\$stop}, all indices in \texttt{\$iList}, and single indices \texttt{\$i} get passed through the \cmdlink{::ndlist::Index2Integer} command, which converts \texttt{end}$\pm$\textit{integer}, \textit{integer}$\pm$\textit{integer} and negative wrap-around indexing (where -1 is equivalent to ``end'') into normal integer indices.
\begin{syntax}
::ndlist::Index2Integer \$index \$n
\end{syntax}
\begin{args}
\$index & Single index. \\
\$n & Number of elements in list.
\end{args}

\begin{example}{Index notation}
\begin{lstlisting}
set A {{1 2 3} {4 5 6} {7 8 9}}
puts [nget $A 0 :]
puts [nget $A 0* :]; # can "flatten" row
puts [nget $A 0:1 1]
puts [nget $A end:0 end:0]; # can have reverse ranges
puts [nget $A {0 0 0} 1*]; # can repeat indices
\end{lstlisting}
\tcblower
\begin{lstlisting}
{1 2 3}
1 2 3
2 5
{9 8 7} {6 5 4} {3 2 1}
2 2 2
\end{lstlisting}
\end{example}
\clearpage
\subsection{Modification}
A ND list can be modified by reference with \cmdlink{nset}, and by value  with \cmdlink{nreplace}, using the same index argument syntax as \cmdlink{nget}. 
If the blank string is used as a replacement value, it will remove values from the ND lists, as long as it is only removing along one dimension. 
Otherwise, the replacement ND list must agree in dimension to the to the index argument dimensions, or be unity. 
For example, you can replace a 4x3 portion of a matrix with 4x3, 4x1, 1x3, or 1x1 matrices.
If modifying outside of the dimensions of the ND list, the ND list will be expanded to the new dimensions, like in the command \cmdlink{ndlist}.
\begin{syntax}
\command{nset} \$varName \$arg1 \$arg2 ... \$sublist
\end{syntax}
\begin{syntax}
\command{nreplace} \$ndlist \$arg1 \$arg2 ... \$sublist
\end{syntax}
\begin{args}
\$varName & Name of ND list to modify. \\
\$ndlist & ND list to modify. \\
\$arg1 \$arg2 ... & Index arguments, using index notation (see pg. \pageref{indexformat}). The number of index arguments determines the interpreted dimensions. \\
\$sublist & Replacement list, or blank to delete values.
\end{args}
\begin{example}{Swapping rows in a matrix}
\begin{lstlisting}
set a {{1 2} {3 4} {5 6}}
nset a {1 0} : [nget $a {0 1} :]
puts $a
\end{lstlisting}
\tcblower
\begin{lstlisting}
{3 4} {1 2} {5 6}
\end{lstlisting}
\end{example}
\begin{example}{Deleting a column in a matrix}
\begin{lstlisting}
set a {{1 2} {3 4} {5 6}}
set b [nreplace $a : 1 ""]
puts $b
\end{lstlisting}
\tcblower
\begin{lstlisting}
1 3 5
\end{lstlisting}
\end{example}
\clearpage

\subsection{Element-Wise Operations}
Basic math operators can be mapped over an ND list with the command \cmdlink{nop}. 

\begin{syntax}
\command{nop} \$nd \$ndlist \$op \$arg...
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to perform element-wise operation over. \\
\$op & Math operator (using tcl::mathop namespace). \\
\$arg... & Operator arguments (see tcl::mathop documentation).
\end{args}

\begin{example}{Element-wise operations}
\begin{lstlisting}
puts [nop 1D {1 2 3} -]
puts [nop 1D {1 2 3} + 1]
puts [nop 2D {{1 2 3} {4 5 6}} >= 3]
\end{lstlisting}
\tcblower
\begin{lstlisting}
-1 -2 -3
2 3 4
{0 0 1} {1 1 1}
\end{lstlisting}
\end{example}

\clearpage
\subsection{ND List Mapping}
The command \cmdlink{nmap} is a general purpose mapping function for N-dimensional lists in Tcl. 
If multiple ND lists are provided for iteration, they must agree in dimension or be unity, like in \cmdlink{nset}. 
Returns an ND list in similar fashion to the Tcl \textit{lmap} command. 
Additionally, elements can be skipped with \textit{continue}, and the entire loop can be exited with \textit{break}.
\begin{syntax}
\command{nmap} \$nd \$varName \$ndlist <\$varName \$ndlist ...> \$body
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$varName & Variable name to iterate with. \\
\$ndlist & ND list to iterate over. \\
\$body & Tcl script to evaluate at every loop iteration. 
\end{args}
\begin{example}{ND list mapping}
\begin{lstlisting}
set testmat {{1 2 3} {4 5 6} {7 8 9}}
# Checkerboard sign pattern
puts [nmap 2D x $testmat {expr {
    $x*([i]%2 + [j]%2 == 1?-1:1)
}}]
# Simple formatting
puts [nmap 2D x $testmat {format %.2f $x}]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{1 -2 3} {-4 5 -6} {7 -8 9}
{1.00 2.00 3.00} {4.00 5.00 6.00} {7.00 8.00 9.00}
\end{lstlisting}
\end{example}

\subsubsection{Index Access}
The iteration indices of \cmdlink{nmap} are accessed with the commands \cmdlink{i}, \cmdlink{j}, \& \cmdlink{k}.
\begin{syntax}
\command{i} <\$axis>
\end{syntax}
\begin{args}	
\$axis & Dimension to access mapping index at. Default 0.
\end{args}
The commands \cmdlink{j} and \cmdlink{k} are simply shorthand for \cmdlink{i} with dimensions 1 and 2.
\begin{syntax}
\command{j}
\end{syntax}
\begin{syntax}
\command{k}
\end{syntax}
\clearpage

\section{ND List Objects}
This package provides the ``ndlist'' type class, using the type system provided by the ``vutil'' package. 
The command \cmdlink{::vutil::new ndlist}, shorthand \cmdlink{tensor}, creates a new ND list object variable, which uses the class \texttt{::ndlist::ndobj}.
The commands \cmdlink{matrix}, \cmdlink{vector}, and \cmdlink{scalar} are shorthand for 2D, 1D, and 0D ND list objects.
\begin{syntax}
\command{::vutil::new ndlist} \$refName \$nd <\$value> \\
\command{tensor} \$refName \$nd <\$value>
\end{syntax}
\begin{syntax}
\command{matrix} \$refName <\$value>
\end{syntax}
\begin{syntax}
\command{vector} \$refName <\$value>
\end{syntax}
\begin{syntax}
\command{scalar} \$refName <\$value>
\end{syntax}
\begin{args}
\$refName & Name of reference variable to tie to object. \\
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$value & ND list value.
\end{args}
\begin{example}{Create ND list object}
\begin{lstlisting}
matrix x {{1 2 3} {4 5 6} {7 8 9}}
puts [$x info]
\end{lstlisting}
\tcblower
\begin{lstlisting}
exists 1 ndims 2 shape {3 3} type ndlist value {{1 2 3} {4 5 6} {7 8 9}}
\end{lstlisting}
\end{example}
\clearpage
\subsection{Standard Methods}
Because the ND list objects are object variables, they have the same basic methods provided by the ``vutil'' package.
For more info on these methods, see the documentation for the ``vutil'' package.
\begin{syntax}
\method{ndlist}{=} \$value \\
\method{ndlist}{<-} \$object \\
\method{ndlist}{-->} \$refName \\
\method{ndlist}{.=} \$oper \\
\method{ndlist}{:=} \$expr \\
\method{ndlist}{::=} \$body \\
\method{ndlist}{info} <\$field> \\
\method{ndlist}{print} <-nonewline> <\$channelID>
\end{syntax}
\begin{args}
\$value & ND list value, passed through the \cmdlink{ndlist} command. \\
\$object & ND list object. \\
\$refName & Reference name to copy to. \\
\$oper & Math operator and arguments, evaluated with \cmdlink{nop}. \\
\$expr & Math expression, evaluated with \cmdlink{nexpr} \\
\$body & Tcl script to evaluate with \cmdlink{neval} \\
\$field & Field to query (fields ``shape'' and ``ndims'' added). \\
\$channelID & Open channel to print to. 
\end{args}
\clearpage
\subsection{ND List Reference Mapping}
Similar to the commands \textit{leval} and \textit{lexpr} in the ``vutil'' package, the commands \cmdlink{neval} and \cmdlink{nexpr} perform element-wise operations over ND list objects.
Both use the command \cmdlink{nmap}, so you have access to the index commands \cmdlink{i}, \cmdlink{j}, and \cmdlink{k}.
Additionally, these are built into the ``\texttt{:=}'' and ``\texttt{::=}'' ND list operators.
\begin{syntax}
\command{neval} \$body <\$nd \$ndlist> <"-{}->" \$refName>
\end{syntax}
\begin{syntax}
\command{nexpr} \$expr <\$nd \$ndlist> <"-{}->" \$refName>
\end{syntax}
\begin{args}
\$body & Tcl script with list object references. \\
\$expr & Tcl expression with list object references. \\
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to iterate over, with \texttt{\$@.} reference. \\
\$refName & Optional reference variable to tie resulting ND list to. Blank to return value.
\end{args}

\begin{example}{Element-wise expressions}
\begin{lstlisting}
matrix x {{1 2} {3 4} {5 6}}
matrix y 5.0
nexpr {$@x + $@y}
\end{lstlisting}
\tcblower
\begin{lstlisting}
{6.0 7.0} {8.0 9.0} {10.0 11.0}
\end{lstlisting}
\end{example}

\begin{example}{Self-operation, using index access commands}
\begin{lstlisting}
matrix x [nrepeat {2 3} 1]
[$x := {$@. * [i]}] print
\end{lstlisting}
\tcblower
\begin{lstlisting}
{0 0 0} {1 1 1}
\end{lstlisting}
\end{example}

\clearpage
\section{ND List Manipulation}
This package provides both 
\subsection{Dimensionality, Shape and Size}
ND list objects store the dimensionality of the list, which can be accessed or changed with the method \methodlink[0]{ndlist}{ndims}.
\begin{syntax}
\method{ndlist}{ndims} <\$nd> 
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  
\end{args}
The shape of an ND list can be accessed with the command \cmdlink{nshape}, and the total size can be accessed with the command \cmdlink{nsize}.
For ND list objects, the methods \methodlink[0]{ndlist}{shape} and \methodlink[0]{ndlist}{size} access the shape and size of the value stored in the object.
\begin{syntax}
\command{nshape} \$nd \$ndlist <\$axis> \\
\method{ndlist}{shape} <\$axis>
\end{syntax}
\begin{syntax}
\command{nsize} \$nd \$ndlist \\
\method{ndlist}{size}
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to get dimensions of. \\
\$axis & Axis to get dimension along. Blank for all. \\
\end{args}

\begin{example}{Shape and size}
\begin{lstlisting}
set x {{1 2} {3 4} {5 6}}
puts [nshape 2D $x]
puts [nsize 2D $x]
# Convert scalar ND list object to matrix
scalar x 5.0
$x ndims 2
puts [$x shape]
\end{lstlisting}
\tcblower
\begin{lstlisting}
3 2
6
1 1
\end{lstlisting}
\end{example}

\clearpage
\subsection{Flattening and Reshaping}
The command \cmdlink{nflatten} flattens an ND list, and the command \cmdlink{nreshape} flattens and reshapes an ND list to a compatible shape.
For ND list objects, the methods \methodlink[0]{ndlist}{flatten} and \methodlink[0]{ndlist}{reshape} flatten and reshape the value stored in the object.
\begin{syntax}
\command{nflatten} \$nd \$ndlist \\
\method{ndlist}{flatten}
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to flatten. 
\end{args}
\begin{syntax}
\command{nreshape} \$nd \$ndlist \$shape \\
\method{ndlist}{reshape} \$shape
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to flatten and reshape. \\
\$shape & New shape (list of dimensions).
\end{args}

\begin{example}{Flatten and reshape ND lists}
\begin{lstlisting}
puts [nflatten 2D {{1 2} {3 4} {5 6}}]
puts [nreshape 1D {1 2 3 4 5 6 7 8} {2 2 2}]
\end{lstlisting}
\tcblower
\begin{lstlisting}
1 2 3 4 5 6
{{1 2} {3 4}} {{5 6} {7 8}}
\end{lstlisting}
\end{example}

\clearpage

\subsection{Transpose}
The command \cmdlink{ntranspose} or the method \methodlink[0]{ndlist}{transpose} swaps axes of an ndlist. 
By default, it just transposes the matrix representation of the data, swapping rows and columns.
For ND list objects, the method \methodlink[0]{ndlist}{transpose} transposes the value stored in the object.
\begin{syntax}
\command{ntranspose} \$nd \$ndlist <\$axis1 \$axis2> \\
\method{ndlist}{transpose} <\$axis1 \$axis2>
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to manipulate. \\
\$axis1 & Axis to swap with axis 2 (default 0) \\
\$axis2 & Axis to swap with axis 1 (default 1)
\end{args}
\begin{example}{Transposing a matrix}
\begin{lstlisting}
puts [ntranspose 2D {{1 2} {3 4}}]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{1 3} {2 4}
\end{lstlisting}
\end{example}
\begin{example}{Swapping axes of a tensor}
\begin{lstlisting}
puts [ntranspose 3D {{{1 2} {3 4}} {{5 6} {7 8}}} 0 2]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{{1 5} {3 7}} {{2 6} {4 8}}
\end{lstlisting}
\end{example}
\clearpage
\subsection{Insertion}
The command \cmdlink{ninsert} allows you to insert a sublist into an ND list at a specified index and axis. 
Sublist must agree in dimension at all other axes.
For ND list objects, the method \methodlink[0]{ndlist}{insert} inserts a sublist into the value stored in the object.
\begin{syntax}
\command{ninsert} \$nd \$ndlist \$index \$sublist <\$axis> \\
\method{ndlist}{insert} \$index \$sublist <\$axis>
\end{syntax}
\begin{args}
\$nd & Dimensionality of ND list (e.g. 2D for a matrix).  \\
\$ndlist & ND list to manipulate. \\
\$index & Index to insert at. \\
\$axis & Axis to insert at (default 0).
\end{args}

\begin{example}{Inserting rows and columns in a matrix}
\begin{lstlisting}
# Insert row
puts [ninsert 2D {{1 2 3} {4 5 6} {7 8 9}} 0 {{A B C}}]
# Insert column
puts [ninsert 2D {1 2 3} end {4 5 6} 1]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{A B C} {1 2 3} {4 5 6} {7 8 9}
{1 4} {2 5} {3 6}
\end{lstlisting}
\end{example}

\begin{example}{Stack tensors}
\begin{lstlisting}
set x [nreshape 1D {1 2 3 4 5 6 7 8 9} {3 3 1}]
set y [nreshape 1D {A B C D E F G H I} {3 3 1}]
puts [ninsert 3D $x end $y 2]
\end{lstlisting}
\tcblower
\begin{lstlisting}
{{1 A} {2 B} {3 C}} {{4 D} {5 E} {6 F}} {{7 G} {8 H} {9 I}}
\end{lstlisting}
\end{example}

\end{document}
